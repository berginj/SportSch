---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection, render } from "astro:content";
import LastUpdated from "../components/LastUpdated.astro";

const sections = (await getCollection("policies")).sort((a, b) => a.data.order - b.data.order);
const latest = [...sections].sort((a, b) => new Date(b.data.lastUpdated).valueOf() - new Date(a.data.lastUpdated).valueOf())[0];
---

<BaseLayout title="Policies" path="/policies">
  <section class="container-shell py-12">
    <h1 class="font-display text-5xl text-brand-secondary">Policies</h1>
    <p class="mt-4 max-w-3xl text-slate-600">
      Plain-language policies for conduct, safety, weather, refunds, and operations.
    </p>
    {latest && <LastUpdated date={latest.data.lastUpdated} />}
  </section>

  <section class="container-shell pb-12">
    <div class="space-y-5">
      {
        await Promise.all(
          sections.map(async (section) => {
            const { Content } = await render(section);
            return (
              <article class="card p-6">
                <h2 class="font-display text-3xl text-brand-secondary">{section.data.title}</h2>
                <p class="mt-2 text-sm text-slate-600">{section.data.summary}</p>
                <div class="prose prose-slate mt-4 max-w-none">
                  <Content />
                </div>
                <LastUpdated date={section.data.lastUpdated} />
              </article>
            );
          })
        )
      }
    </div>
  </section>
</BaseLayout>
